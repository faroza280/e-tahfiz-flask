<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Laporan Hasil Belajar - {{ santri.nama }}</title>
    <!-- Bootstrap untuk layout -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { font-family: 'Times New Roman', Times, serif; font-size: 12pt; color: #000; }
        .kop-surat { border-bottom: 3px double #000; padding-bottom: 10px; margin-bottom: 20px; text-align: center; }
        .kop-surat h1 { font-size: 18pt; font-weight: bold; margin: 0; }
        .kop-surat p { margin: 0; font-size: 11pt; }
        .info-table td { padding: 4px 10px; }
        .nilai-table th, .nilai-table td { border: 1px solid #000 !important; padding: 8px; text-align: center; }
        .nilai-table th { background-color: #f0f0f0 !important; font-weight: bold; -webkit-print-color-adjust: exact; }
        .text-left { text-align: left !important; }
        .ttd-box { margin-top: 50px; text-align: center; float: right; width: 200px; }
        
        /* CSS Khusus Print */
        @media print {
            .no-print { display: none; }
            body { padding: 0; margin: 0; }
        }
    </style>
</head>
<body class="p-5" onload="window.print()">

    <!-- Tombol Kembali (Hilang saat diprint) -->
    <div class="no-print position-fixed top-0 start-0 p-3">
        <button onclick="history.back()" class="btn btn-secondary btn-sm">‚Üê Kembali</button>
    </div>

    <!-- KOP SURAT -->
    <div class="kop-surat">
        <h1>TPQ AL-IKHLAS (LOKASI KKN)</h1>
        <p>Jl. Hidayah No. 1, Desa Sukamaju, Kec. Sejahtera</p>
        <p>Telp: 0812-3456-7890 | Email: admin@tpq-alikhlas.com</p>
    </div>

    <h4 class="text-center mb-4 text-uppercase fw-bold text-decoration-underline">Laporan Capaian Belajar Santri</h4>

    <!-- BIODATA -->
    <table class="info-table mb-4">
        <tr>
            <td width="150">Nama Santri</td>
            <td width="10">:</td>
            <td class="fw-bold">{{ santri.nama }}</td>
        </tr>
        <tr>
            <td>Nomor Induk (NIS)</td>
            <td>:</td>
            <td>{{ santri.nis if santri.nis else '-' }}</td>
        </tr>
        <tr>
            <td>Kelas/Halaqah</td>
            <td>:</td>
            <td>{{ santri.kelas }}</td>
        </tr>
        <tr>
            <td>Periode Laporan</td>
            <td>:</td>
            <td>{{ tanggal_cetak.strftime('%B %Y') }}</td>
        </tr>
    </table>

    <div class="row">
        <!-- TABEL ABSENSI -->
        <div class="col-6">
            <h5 class="fw-bold mb-2 fs-6">A. Rekapitulasi Kehadiran</h5>
            <table class="table nilai-table w-100 mb-4">
                <tr>
                    <th>Status</th>
                    <th>Jumlah</th>
                    <th>Keterangan</th>
                </tr>
                <tr>
                    <td class="text-left">Hadir</td>
                    <td>{{ summary.hadir }}</td>
                    <td rowspan="4" class="align-middle">
                        {% set total_hari = summary.hadir + summary.sakit + summary.izin + summary.alpha %}
                        {% if total_hari > 0 %}
                            Kehadiran: {{ ((summary.hadir / total_hari) * 100)|round|int }}%
                        {% else %}
                            -
                        {% endif %}
                    </td>
                </tr>
                <tr>
                    <td class="text-left">Sakit</td>
                    <td>{{ summary.sakit }}</td>
                </tr>
                <tr>
                    <td class="text-left">Izin</td>
                    <td>{{ summary.izin }}</td>
                </tr>
                <tr>
                    <td class="text-left">Alpha</td>
                    <td>{{ summary.alpha }}</td>
                </tr>
            </table>
        </div>

        <!-- TABEL RINGKASAN HAFALAN -->
        <div class="col-6">
            <h5 class="fw-bold mb-2 fs-6">B. Ringkasan Hafalan</h5>
            <table class="table nilai-table w-100 mb-4">
                <tr>
                    <th colspan="2">Capaian Bulan Ini</th>
                </tr>
                <tr>
                    <td class="text-left">Total Setoran</td>
                    <td class="fw-bold">{{ summary.total_setoran }} kali pertemuan</td>
                </tr>
                <tr>
                    <td class="text-left">Kualitas Rata-rata</td>
                    <td class="fw-bold">{{ summary.nilai_rata_rata }}</td>
                </tr>
                <tr>
                    <td class="text-left">Total Hafalan</td>
                    <td class="fw-bold">- Juz (Akumulasi)</td>
                </tr>
            </table>
        </div>
    </div>

    <!-- TABEL DETAIL SETORAN -->
    <h5 class="fw-bold mb-2 fs-6">C. Detail Setoran Hafalan</h5>
    <table class="table nilai-table w-100 mb-4">
        <thead>
            <tr>
                <th width="5%">No</th>
                <th width="20%">Tanggal</th>
                <th width="40%">Surat & Ayat</th>
                <th width="15%">Jenis</th>
                <th width="20%">Kualitas / Predikat</th>
            </tr>
        </thead>
        <tbody>
            {% for s in setoran %}
            <tr>
                <td>{{ loop.index }}</td>
                <td>{{ s.tanggal.strftime('%d-%m-%Y') }}</td>
                <td class="text-left">{{ s.surat }} (Ayat {{ s.ayat_awal }}-{{ s.ayat_akhir }})</td>
                <td>{{ s.jenis_setoran if s.jenis_setoran else 'Ziyadah' }}</td>
                <td>{{ s.kualitas }}</td>
            </tr>
            {% else %}
            <tr><td colspan="5">Belum ada data setoran bulan ini.</td></tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- TANDA TANGAN -->
    <div class="ttd-box">
        <p>Kota Santri, {{ tanggal_cetak.strftime('%d %B %Y') }}</p>
        <p class="mb-5">Ustadz Pembimbing,</p>
        <br>
        <p class="fw-bold text-decoration-underline">{{ santri.ustadz.nama if santri.ustadz else '.........................' }}</p>
    </div>

</body>
</html>